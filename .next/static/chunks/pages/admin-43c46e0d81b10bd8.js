(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964],{8195:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return n(6093)}])},6093:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return r}});var a=n(5893),s=n(7294);function i(){return localStorage.getItem("smtl_token")}function r(){let[e,t]=(0,s.useState)(!1),[n,r]=(0,s.useState)(null);async function l(e){e.preventDefault();let n=e.target.password.value,a=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:n})});if(a.ok){let e=await a.json();localStorage.setItem("smtl_token",e.token),t(!0)}else alert("Login failed")}async function o(e){if(e.preventDefault(),!i()){alert("not authed");return}let t=e.target.title.value,n=e.target.content.value,a=e.target.tags.value.split(",").map(e=>e.trim()).filter(Boolean);(await fetch("/api/createPost",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+i()},body:JSON.stringify({title:t,content:n,tags:a})})).ok?(e.target.reset(),r(await (await fetch("/api/posts")).json())):alert("create failed")}async function c(e){confirm("Delete?")&&((await fetch("/api/deletePost",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+i()},body:JSON.stringify({id:e})})).ok?r(t=>t.filter(t=>t.id!==e)):alert("delete failed"))}return(0,s.useEffect)(()=>{i()&&t(!0),fetch("/api/posts").then(e=>e.ok?e.json():[]).then(r).catch(()=>r([]))},[]),(0,a.jsxs)("div",{children:[(0,a.jsx)("header",{className:"site-header",children:(0,a.jsx)("div",{className:"container",children:(0,a.jsx)("h1",{children:"Admin"})})}),(0,a.jsxs)("main",{className:"container",children:[!e&&(0,a.jsxs)("section",{children:[(0,a.jsx)("h2",{children:"Login"}),(0,a.jsxs)("form",{onSubmit:l,className:"login-form",children:[(0,a.jsx)("label",{children:"Password"}),(0,a.jsx)("input",{name:"password",type:"password"}),(0,a.jsx)("button",{children:"Login"})]})]}),e&&(0,a.jsxs)("section",{children:[(0,a.jsx)("h2",{children:"Create post"}),(0,a.jsxs)("form",{onSubmit:o,className:"create-form",children:[(0,a.jsx)("label",{children:"Title"}),(0,a.jsx)("input",{name:"title"}),(0,a.jsx)("label",{children:"Content"}),(0,a.jsx)("textarea",{name:"content",rows:6}),(0,a.jsx)("label",{children:"Tags (comma separated)"}),(0,a.jsx)("input",{name:"tags"}),(0,a.jsx)("button",{children:"Create"})]}),(0,a.jsx)("h3",{style:{marginTop:18},children:"Existing posts"}),(0,a.jsxs)("div",{className:"post-list",children:[!n&&"Loading...",n&&n.map(e=>(0,a.jsxs)("div",{className:"post-card",children:[(0,a.jsxs)("h3",{children:[e.title," ",(0,a.jsx)("button",{onClick:()=>c(e.id),style:{float:"right"},children:"Delete"})]}),(0,a.jsx)("p",{className:"muted",children:e.created_at}),(0,a.jsx)("p",{children:(e.content||"").slice(0,300)})]},e.id))]})]})]})]})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=8195)}),_N_E=e.O()}]);